<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>XJJ Video</title>
    <style>
      body {
        margin: 0;
        overflow: hidden;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        height: 100vh;
        background-color: #000;
      }

      .video {
        width: 90%;
        height: 90%;
        object-fit: contain;
        position: absolute;
        top: 5%;
        left: 5%;
        transition: opacity 1s ease-in-out;
        opacity: 1;
        display: block;
      }
      .video.hidden {
        opacity: 0;
      }

      #videoContainer {
        position: relative;
        width: 100%;
        height: 90vh;
        overflow: hidden;
        display: flex;
        justify-content: center;
        align-items: center;
      }

      #controls {
        width: 100%;
        height: 10vh;
        display: flex;
        justify-content: center;
        align-items: center;
        background-color: #222;
      }

      button {
        margin: 0 10px;
        padding: 10px 20px;
        font-size: 16px;
        cursor: pointer;
        border: none;
        border-radius: 5px;
        background-color: #444;
        color: white;
      }

      button.active {
        background-color: #666;
      }

      #videoSource {
        padding: 10px 15px;
        font-size: 16px;
        color: #fff;
        background-color: #444;
        border: none;
        border-radius: 5px;
        appearance: none;
        -webkit-appearance: none;
        -moz-appearance: none;
        outline: none;
        cursor: pointer;
        margin-bottom: 20px;
      }

      #videoSource:hover {
        background-color: #666;
      }

      #videoSource:focus {
        box-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
      }

      #videoSource {
        background-image: url('data:image/svg+xml;utf8,<svg fill="%23ffffff" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"/></svg>');
        background-repeat: no-repeat;
        background-position: right 10px center;
        background-size: 20px;
        padding-right: 40px;
      }

    </style>
  </head>
  <body>
    <select id="videoSource">
      <option value="https://api.yujn.cn/api/zzxjj.php?type=json">遇见API1</option>
      <option value="https://api.yujn.cn/api/xjj.php?type=json">遇见API2</option>
      <option value="https://api.qqsuu.cn/api/dm-xjj2?type=json">qqsuu1</option>
      <option value="https://api.cenguigui.cn/api/mp4/MP4_xiaojiejie.php?type=json">qqsuu2</option>
    </select>

    <div id="videoContainer">
      <video id="videoPlayer" class="video" controls preload="auto"></video>
      <video id="videoPlayer1" class="video" controls preload="auto"></video>
    </div>

    <div id="controls">
      <button id="muteButton">打开声音</button>
      <button id="autoPlayButton">关闭自动切换</button>
      <button id="nextVideoButton">切换下一个</button>
    </div>

    <script>
      const videoSourceSelect = document.getElementById("videoSource");
      let currentPlayer = document.getElementById("videoPlayer");
      let prePlayer = document.getElementById("videoPlayer1");
      let isMuted = true; // 默认静音
      let currentApiUrl = videoSourceSelect.value; // 默认视频来源

      videoSourceSelect.addEventListener("change", () => {
        currentApiUrl = videoSourceSelect.value;
        initializeVideos(); // 切换视频源时重新加载视频
      });

      async function fetchVideoUrl() {
        try {
          // 请求 Cloudflare Worker 处理的 API 路径
          const response = await fetch(`/api?url=${encodeURIComponent(currentApiUrl)}`);
          const data = await response.json();
          return data.url;
        } catch (err) {
          console.error("Failed to fetch video url: ", err);
          return null;
        }
      }

      async function initializeVideos() {
        prePlayer.classList.add("hidden");
        prePlayer.style.display = "none";
        currentPlayer.muted = isMuted;
        prePlayer.muted = isMuted;

        const url1 = await fetchVideoUrl();
        const url2 = await fetchVideoUrl();

        if (url1) {
          currentPlayer.src = url1;
          currentPlayer.load();
          currentPlayer.play();
        }

        if (url2) {
          prePlayer.src = url2;
          prePlayer.load();
        }
      }
    </script>
  </body>
</html>
